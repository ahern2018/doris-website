"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["512985"],{70246:function(e,n,t){t.r(n),t.d(n,{metadata:()=>a,contentTitle:()=>o,default:()=>u,assets:()=>l,toc:()=>d,frontMatter:()=>r});var a=JSON.parse('{"id":"table-design/data-model/duplicate","title":"Detail Model","description":"\x3c!--","source":"@site/versioned_docs/version-3.0/table-design/data-model/duplicate.md","sourceDirName":"table-design/data-model","slug":"/table-design/data-model/duplicate","permalink":"/docs/3.0/table-design/data-model/duplicate","draft":false,"unlisted":false,"tags":[],"version":"3.0","frontMatter":{"title":"Detail Model","language":"en"},"sidebar":"docs","previous":{"title":"Table Model Overview","permalink":"/docs/3.0/table-design/data-model/overview"},"next":{"title":"Primary Key Model","permalink":"/docs/3.0/table-design/data-model/unique"}}'),i=t("785893"),s=t("250065");let r={title:"Detail Model",language:"en"},o=void 0,l={},d=[{value:"Use Cases",id:"use-cases",level:2},{value:"Table Creation Instructions",id:"table-creation-instructions",level:2},{value:"Data Insertion and Storage",id:"data-insertion-and-storage",level:2}];function c(e){let n={a:"a",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["In Doris, the ",(0,i.jsx)(n.strong,{children:"Detail Model"})," is the default table model, and it can be used to store every individual raw data record. The ",(0,i.jsx)(n.code,{children:"Duplicate Key"})," specified during table creation determines the columns by which the data is sorted and stored, which can be used to optimize common queries. It is generally recommended to choose no more than three columns as the sort key. For more specific selection guidelines, refer to ",(0,i.jsx)(n.a,{href:"../index/prefix-index",children:"Sort Key"}),". The Detail Model has the following characteristics:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Preserving Raw Data"}),": The Detail Model retains all original data, making it suitable for storing and querying raw data. For use cases that require detailed data analysis later on, it is recommended to use the Detail Model to avoid the risk of data loss."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"No Deduplication or Aggregation"}),": Unlike the Aggregate and Primary Key models, the Detail Model does not perform deduplication or aggregation. Every data insertion, even if two records are identical, will be fully retained."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Flexible Data Querying"}),": The Detail Model retains the complete original data, which allows detailed extraction from the full data set. This enables aggregation operations across any dimension on the full dataset, allowing for metadata auditing and fine-grained analysis."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,i.jsx)(n.p,{children:"In the Detail Model, data is generally only appended, and old data is not updated. The Detail Model is typically used in scenarios where full raw data is required:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Log Storage"}),": Used for storing various types of application logs, such as access logs, error logs, etc. Each piece of data needs to be detailed for future auditing and analysis."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"User Behavior Data"}),": When analyzing user behavior, such as click data or user access paths, it is necessary to retain detailed user actions. This helps in building user profiles and conducting detailed analysis of behavior patterns."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Transaction Data"}),": For storing transaction or order data, once a transaction is completed, there is typically no need for data changes..."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"table-creation-instructions",children:"Table Creation Instructions"}),"\n",(0,i.jsxs)(n.p,{children:["When creating a table, the ",(0,i.jsx)(n.strong,{children:"DUPLICATE KEY"})," keyword can be used to specify the Detail Model. The Detail table must specify the Key columns, which are used to sort the data during storage. In the following example, the Detail table stores log information and sorts the data based on the ",(0,i.jsx)(n.code,{children:"log_time"}),", ",(0,i.jsx)(n.code,{children:"log_type"}),", and ",(0,i.jsx)(n.code,{children:"error_code"})," columns:"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"columnar_storage",src:t(436887).Z+"",width:"3652",height:"1528"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE IF NOT EXISTS example_tbl_duplicate\n(\n    log_time        DATETIME       NOT NULL,\n    log_type        INT            NOT NULL,\n    error_code      INT,\n    error_msg       VARCHAR(1024),\n    op_id           BIGINT,\n    op_time         DATETIME\n)\nDUPLICATE KEY(log_time, log_type, error_code)\nDISTRIBUTED BY HASH(log_type) BUCKETS 10;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"data-insertion-and-storage",children:"Data Insertion and Storage"}),"\n",(0,i.jsx)(n.p,{children:"In a Detail table, data is not deduplicated or aggregated; inserting data directly stores it. The Key columns in the Detail Model are used for sorting."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"columnar_storage",src:t(345281).Z+"",width:"5508",height:"1576"})}),"\n",(0,i.jsx)(n.p,{children:"In the example above, there are initially 4 rows of data in the table. After inserting 2 rows, the data is appended (APPEND) to the table, resulting in a total of 6 rows stored in the Detail table."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- 4 rows raw data\nINSERT INTO example_tbl_duplicate VALUES\n('2024-11-01 00:00:00', 2, 2, 'timeout', 12, '2024-11-01 01:00:00'),\n('2024-11-02 00:00:00', 1, 2, 'success', 13, '2024-11-02 01:00:00'),\n('2024-11-03 00:00:00', 2, 2, 'unknown', 13, '2024-11-03 01:00:00'),\n('2024-11-04 00:00:00', 2, 2, 'unknown', 12, '2024-11-04 01:00:00');\n\n-- insert into 2 rows\nINSERT INTO example_tbl_duplicate VALUES\n('2024-11-01 00:00:00', 2, 2, 'timeout', 12, '2024-11-01 01:00:00'),\n('2024-11-01 00:00:00', 2, 2, 'unknown', 13, '2024-11-01 01:00:00');\n\n-- check the rows of table\nSELECT * FROM example_tbl_duplicate;\n+---------------------+----------+------------+-----------+-------+---------------------+\n| log_time            | log_type | error_code | error_msg | op_id | op_time             |\n+---------------------+----------+------------+-----------+-------+---------------------+\n| 2024-11-02 00:00:00 |        1 |          2 | success   |    13 | 2024-11-02 01:00:00 |\n| 2024-11-01 00:00:00 |        2 |          2 | timeout   |    12 | 2024-11-01 01:00:00 |\n| 2024-11-03 00:00:00 |        2 |          2 | unknown   |    13 | 2024-11-03 01:00:00 |\n| 2024-11-04 00:00:00 |        2 |          2 | unknown   |    12 | 2024-11-04 01:00:00 |\n| 2024-11-01 00:00:00 |        2 |          2 | unknown   |    13 | 2024-11-01 01:00:00 |\n| 2024-11-01 00:00:00 |        2 |          2 | timeout   |    12 | 2024-11-01 01:00:00 |\n+---------------------+----------+------------+-----------+-------+---------------------+\n"})})]})}function u(e={}){let{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},436887:function(e,n,t){t.d(n,{Z:function(){return a}});let a=t.p+"assets/images/columnar-storage-9c19f70f5cc5f4aae736d93b960a0d5d.png"},345281:function(e,n,t){t.d(n,{Z:function(){return a}});let a=t.p+"assets/images/duplicate-table-insert-663b9ee1dbe7b93b28123e2eeb1c435d.png"},250065:function(e,n,t){t.d(n,{Z:function(){return o},a:function(){return r}});var a=t(667294);let i={},s=a.createContext(i);function r(e){let n=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);